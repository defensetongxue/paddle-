## 论文复现指南
本文为第一次复现论文的同学提供论文复现指南，适合python基础相对薄弱的同学，熟悉复现论文流程。

文章适用于的论文前提是已经有pytorch实现的论文。

文章结构为列举论文复现的主要步骤，在`具体复现步骤`中给出关键详细说明。复现论文分为两个时期。

1. 模型测试阶段
2. 模型训练阶段

我们分别在`代码模板`中给出具体可参考的模板，在模板中我们会留出对应的部分供您填写。

以下把需要复现的模型称为<module>。接下来，我会用我复现的cvt举例，完成具体步骤的举例。
## 实现一个<module>.py文件
此文件的主体为一个module的class，还有一个build_<module>的函数，负责生成<module>类的实例。

在这个阶段，你需要找到论文原文，参考知乎、CSDN等对模型的分析，理解论文的大概算法。然后找到论文中对应链接的官方实现仓库。这里需要注意，一般一篇论文有其他的实现方式，我们统一采用官方的实现方式。(例如，cvt模型的官方实现仓库是<https://github.com/microsoft/CvT/tree/4cedb05b343e13ab08c0a29c5166b6e94c751112>，pytorch中的timm框架也实现了很多模型并提供了预训练权重)

这里你需要寻找对应模型的预训练模型，预训练模型对测试你的模型正确性具有关键作用，所以如果没有找到预训练模型，最好和老师联系说明情况。

<img src='./picture/modeZoo.jpg' style="width:70%;height:70%">

找到官方实现仓库之后，接下来需要仿照官方的实现实现一个基于paddle的模型。你主要需要做如下的几件事。

1. 把pytorch的api转化为paddle的api，这一块，需要你查阅paddle官方文档，官方文档中包括了pytorch和paddle的API对照表，和具体每个函数的作用。
2. 对于部分具体函数的实现，paddle和pytorch有一些区别，可以参考具体的，`模型实现具体注意事项`。
## 测试<module>正确性
现在，你已经写完了<module>.py现在你需要测试你的模型是否正确。具体可以参考模型测试阶段模板。

对于一个模型，除了具体模型的结构，其中很多`可训练的参数`会在模型的训练中变化，而paddle对每一个Layer的初始化不一定和pytorch相同，为了测试你写的模型是否正确，我们需要加载和pytorch同样的参数，在相同且随机的输入下，如果产生了参数相同的输出，则基本可以说明模型问题不大(但在一些情况下，即使能够通过相同输出的测试，模型可能仍存在问题)。可以加载的模型以`.pth`结尾。

你需要做两件事一件事是完成一个`config.py`文件和一个`configs`文件夹，文件夹里面含有一个或多个`.yaml`文件，`.yaml`文件是对config的更新。具体可以参考`config编写`。

其次你需要把pytorch预训练模型加载到paddle模型中。这一部分是去原文仓库中找到对应的预训练模型，下载一个最小的预训练模型`.pth`文件，然后使用`load`

，输入随机的张量进行测试。当测试通过，这个阶段的工作就完成了。测试完成后，需要把对应的预训练参数保存在`.pdparams`

具体步骤可以参考`具体步骤实现/config编写`

## 模型在实际运行中的测试

在通过了张量测试后，需要对模型进行训练和测试。这一部分需要你参考`代码模板/模型训练阶段模板`进行修改。

本阶段主要把`cvt.py`文件替换成你的模型实现文件。把`config`和`configs文件夹`替换成你代码测试阶段的文件。需要注意的是，原文的仓库中可能附带了不止一个预训练模型，我们最好都转化并保存成对应的paddle模型。

测试阶段可以去`AIStudio`每天有8小时免费算力，也可以和老师协商解决。

如果发现测试结果和论文给出的结果差距过大，并且模型在测试阶段通过了随机张量测试。那么说明很可能是load权重的时候漏掉了一项，这个时候可以打印模型参数仔细检查一下，并且要注意转置问题，有的参数中在paddle中和pytorch中需要转置一下(绝大多数情况，二维需要转置，而其他维不需要)。
